<!doctype html>
<html lang="ru" class="scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
    <meta name="color-scheme" content="light" />
    <meta
      name="description"
      content="–ú–∞–≥–∞–∑–∏–Ω—á–∏–∫ –∑–∞ –±–∞–ª–ª—ã: –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Twitch, –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞ –∏–∑ Google –¢–∞–±–ª–∏—Ü—ã, –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤ –≤ Telegram."
    />
    <title>–ú–∞–≥–∞–∑–∏–Ω—á–∏–∫ –∑–∞ –±–∞–ª–ª—ã ‚Äî –Ø–º–∏</title>

    <style>
      :root{
        --glass-bg: rgba(255,255,255,.55);
        --glass-brd: rgba(255,255,255,.45);
        --shadow: 0 18px 55px rgba(18, 28, 55, .14);
      }

      html, body{ height: 100%; }

      body{
        min-height: 100vh;
        color: rgb(15 23 42);
        background:
          radial-gradient(1200px 800px at 10% 10%, rgba(100,150,220,.30), transparent 60%),
          radial-gradient(1000px 700px at 90% 20%, rgba(80,140,200,.25), transparent 55%),
          radial-gradient(900px 700px at 40% 100%, rgba(100,160,200,.20), transparent 55%),
          linear-gradient(135deg, #1a2f4f 0%, #2d4a7a 50%, #1f3a5f 100%);
      }

      .glass{
        background: var(--glass-bg);
        border: 1.5px solid var(--glass-brd);
        box-shadow:
          var(--shadow),
          0 0 30px rgba(100, 200, 255, 0.15),
          inset 0 1px 2px rgba(255, 255, 255, 0.3);
        backdrop-filter: blur(14px);
        -webkit-backdrop-filter: blur(14px);
      }

      .glass:hover{
        box-shadow:
          var(--shadow),
          0 0 40px rgba(100, 200, 255, 0.25),
          inset 0 1px 2px rgba(255, 255, 255, 0.3);
      }

      .glow{ position: relative; }
      .glow::before{
        content:"";
        position:absolute;
        inset:-2px;
        border-radius: inherit;
        pointer-events:none;
        background: linear-gradient(135deg,
          rgba(100, 200, 255, 0.4),
          rgba(150, 180, 255, 0.2),
          rgba(100, 200, 255, 0.3)
        );
        filter: blur(15px);
        opacity: 0.6;
        z-index:-1;
      }

      .floaty{
        position: absolute;
        border-radius: 999px;
        filter: blur(22px);
        opacity: .35;
        mix-blend-mode: multiply;
        pointer-events: none;
      }

      /* Reveal */
      .reveal{ opacity: 0; transform: translateY(14px); transition: opacity .6s ease, transform .6s ease; }
      .reveal.is-in{ opacity: 1; transform: translateY(0); }
      .no-io .reveal{ opacity: 1 !important; transform: none !important; transition: none !important; }

      .modal-backdrop{ background: rgba(20, 30, 55, .35); backdrop-filter: blur(6px); -webkit-backdrop-filter: blur(6px); }

      #petals{ position: fixed; inset: 0; pointer-events: none; overflow: hidden; z-index: 0; }

      @media (prefers-reduced-motion: reduce){
        .reveal{ transition: none !important; }
      }
    </style>
  </head>

  <body class="text-slate-900">
    <div id="petals" aria-hidden="true"></div>

    <div class="pointer-events-none fixed inset-0 -z-10">
      <div
        class="floaty hidden lg:block"
        style="top:10%;left:8%;width:220px;height:220px;background:rgba(100,200,255,.25);box-shadow:0 0 80px rgba(100,200,255,.2)"
      ></div>
      <div
        class="floaty hidden lg:block"
        style="top:18%;right:10%;width:260px;height:260px;background:rgba(120,180,255,.20);box-shadow:0 0 100px rgba(120,180,255,.15)"
      ></div>
      <div
        class="floaty hidden lg:block"
        style="bottom:12%;left:18%;width:300px;height:300px;background:rgba(100,220,255,.15);box-shadow:0 0 120px rgba(100,220,255,.1)"
      ></div>
    </div>

    <div id="inAppWarning" class="hidden mx-auto max-w-6xl px-4 pt-3">
      <div class="glass rounded-2xl p-4 border border-amber-200/60 bg-amber-50/60">
        <div class="flex items-start gap-3">
          <div class="text-xl">‚ö†Ô∏è</div>
          <div class="text-sm text-slate-800">
            –ü–æ—Ö–æ–∂–µ, —Ç—ã –æ—Ç–∫—Ä—ã–ª(–∞) —Å–∞–π—Ç –≤–æ –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–º –±—Ä–∞—É–∑–µ—Ä–µ (Telegram/Instagram/Facebook). –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è Twitch –∏
            –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–≥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ. –õ—É—á—à–µ –æ—Ç–∫—Ä—ã—Ç—å –≤ –æ–±—ã—á–Ω–æ–º –±—Ä–∞—É–∑–µ—Ä–µ (Chrome/Safari).
          </div>
        </div>
      </div>
    </div>

    <main class="relative z-10 mx-auto max-w-6xl px-4 pb-16 pt-6 md:pt-10">
      <div id="top"></div>

      <section class="reveal">
        <div class="glass glow rounded-3xl p-6 md:p-8">
          <h1 class="text-2xl md:text-3xl font-bold tracking-tight">‚ú® –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –º–∞–≥–∞–∑–∏–Ω—á–∏–∫ ‚ú®</h1>
          <p class="mt-3 text-slate-700 leading-relaxed">
            –ó–¥–µ—Å—å —Ç—ã –º–æ–∂–µ—à—å –∑–∞–∫–∞–∑–∞—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç –∑–∞ –±–∞–ª–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞—Ä–∞–±–æ—Ç–∞–ª(–∞) –Ω–∞ –∫–ª–∏–ø–∞—Ö.
          </p>

          <div class="mt-5 grid sm:grid-cols-3 gap-3">
            <div class="glass rounded-2xl p-4 border border-white/60">
              <div class="text-2xl mb-2">üé¨</div>
              <div class="text-sm text-slate-600">–°–æ–∑–¥–∞–≤–∞–π –∫–ª–∏–ø—ã</div>
              <div class="font-semibold">+50 –±–∞–ª–ª–æ–≤ –∑–∞ –∫–ª–∏–ø</div>
            </div>
            <div class="glass rounded-2xl p-4 border border-white/60">
              <div class="text-2xl mb-2">üõí</div>
              <div class="text-sm text-slate-600">–í—ã–±–∏—Ä–∞–π –Ω–∞–≥—Ä–∞–¥—ã</div>
              <div class="font-semibold">–ú–µ–º—ã, –∫–∏–Ω–æ, –∏–≥—Ä—ã</div>
            </div>
            <div class="glass rounded-2xl p-4 border border-white/60">
              <div class="text-2xl mb-2">üì©</div>
              <div class="text-sm text-slate-600">–ó–∞–∫–∞–∑—ã–≤–∞–π</div>
              <div class="font-semibold">–ü—Ä—è–º–æ —Å —Å–∞–π—Ç–∞</div>
            </div>
          </div>

          <div class="mt-5 flex flex-wrap gap-2">
            <a
              href="#products"
              class="px-4 py-2 rounded-xl bg-white/75 hover:bg-white transition border border-white/70 font-medium"
              >–í—ã–±—Ä–∞—Ç—å —Ç–æ–≤–∞—Ä</a
            >
            <a
              href="#rules"
              class="px-4 py-2 rounded-xl glass hover:bg-white/60 transition border border-white/60 font-medium"
              >–ü—Ä–∞–≤–∏–ª–∞ –∏ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</a
            >
            <a
              href="#order"
              class="px-4 py-2 rounded-xl glass hover:bg-white/60 transition border border-white/60 font-medium"
              >–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞</a
            >
          </div>
        </div>
      </section>

      <section id="rules" class="mt-8 md:mt-10">
        <div class="glass glow rounded-3xl p-6 md:p-8 reveal">
          <div class="grid lg:grid-cols-[1fr_340px] gap-8 items-start">
            <div>
              <h2 class="text-xl md:text-2xl font-bold">üìå –ü–†–ê–í–ò–õ–ê –ù–ê–ß–ò–°–õ–ï–ù–ò–Ø –ë–ê–õ–õ–û–í</h2>
              <p class="mt-2 text-slate-600">–ë–∞–ª–ª—ã –Ω–∞—á–∏—Å–ª—è—é—Ç—Å—è –∑–∞ –∫–ª–∏–ø—ã. –ù–∏–∂–µ ‚Äî –ø—Ä–∞–≤–∏–ª–∞, –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∏ –≤–∏—Ç—Ä–∏–Ω–∞ —Ç–æ–≤–∞—Ä–æ–≤.</p>

              <div class="mt-4 space-y-2 text-slate-800 leading-relaxed">
                <p>üé¨ –ó–∞ –∫–∞–∂–¥—ã–π –∫–ª–∏–ø ‚Üí <b>+50</b> üôÇ.</p>
                <p>
                  ‚ú® –ï—Å–ª–∏ –∫–ª–∏–ø–æ–≤ –±–æ–ª—å—à–µ –æ–¥–Ω–æ–≥–æ ‚Üí –∫ –∫–∞–∂–¥–æ–º—É —Å–ª–µ–¥—É—é—â–µ–º—É –¥–æ–±–∞–≤–ª—è–µ–º <b>+3%</b> –æ—Ç —Å—É–º–º—ã –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –∫–ª–∏–ø–∞.
                </p>

                <div class="mt-3 glass rounded-2xl p-4 border border-white/60">
                  <div class="font-semibold mb-2">–ü—Ä–∏–º–µ—Ä—ã:</div>
                  <ul class="space-y-1 text-sm text-slate-700">
                    <li>1 –∫–ª–∏–ø = 50 üôÇ</li>
                    <li>2 –∫–ª–∏–ø–∞ = 100 + 3% √ó 100 √ó 1 = 103 üôÇ</li>
                    <li>3 –∫–ª–∏–ø–∞ = 150 + 3% √ó 150 √ó 2 = 159 üôÇ</li>
                    <li>4 –∫–ª–∏–ø–∞ = 200 + 3% √ó 200 √ó 3 = 218 üôÇ</li>
                  </ul>
                </div>

                <p class="mt-3">‚ö†Ô∏è –í–∞–∂–Ω–æ: –µ—Å–ª–∏ –∫–ª–∏–ø –Ω–µ –æ —á–µ–º ‚Äî –±–∞–ª–ª—ã –Ω–µ –Ω–∞—á–∏—Å–ª—è—é—Ç—Å—è!</p>
                <p>üí° –°–æ–≤–µ—Ç: –ß–µ–º –±–æ–ª—å—à–µ –∫–ª–∏–ø–æ–≤ –≤ —Å—Ç—Ä–∏–º–µ ‚Äî —Ç–µ–º –≤—ã–≥–æ–¥–Ω–µ–µ!</p>

                <div class="mt-4 glass rounded-2xl p-4 border border-white/60">
                  <p class="text-slate-800">üéÆ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–≤–æ–∏ –±–∞–ª–ª—ã –º–æ–∂–Ω–æ –≤ —á–∞—Ç–µ Twitch –∫–æ–º–∞–Ω–¥–æ–π <b>!–ë–∞–ª–∞–Ω—Å</b></p>
                </div>
              </div>

              <div class="mt-5 flex flex-wrap gap-2">
                <button
                  id="openCalc"
                  type="button"
                  class="px-4 py-2 rounded-xl bg-white/75 hover:bg-white transition border border-white/70 font-medium"
                >
                  –û—Ç–∫—Ä—ã—Ç—å –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –±–∞–ª–ª–æ–≤
                </button>

                <button
                  id="copyBalanceCmd"
                  type="button"
                  class="px-4 py-2 rounded-xl glass hover:bg-white/60 transition border border-white/60 font-medium"
                >
                  –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—É !–ë–∞–ª–∞–Ω—Å
                </button>
              </div>
            </div>

            <aside class="glass glow rounded-3xl p-5 border border-white/60">
              <div class="flex items-center justify-between gap-3 mb-4">
                <h3 class="text-lg font-bold">–ë–∞–ª–∞–Ω—Å</h3>
                <div class="text-xs text-slate-600">—á–µ—Ä–µ–∑ Google –¢–∞–±–ª–∏—Ü—É</div>
              </div>

              <div id="balanceUnauthed" class="space-y-3">
                <div class="glass rounded-2xl p-4 border border-white/60">
                  <div class="text-xs text-slate-600">–°—Ç–∞—Ç—É—Å</div>
                  <div class="font-semibold truncate">–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω(–∞)</div>
                  <div class="text-xs text-slate-600 mt-1">–í–æ–π–¥–∏ —á–µ—Ä–µ–∑ Twitch, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –±–∞–ª–∞–Ω—Å –∏ –æ—Ñ–æ—Ä–º–ª—è—Ç—å –∑–∞–∫–∞–∑.</div>
                </div>

                <div id="balanceMsg" class="hidden"></div>

                <button
                  id="btnLogin"
                  type="button"
                  class="w-full px-4 py-2 rounded-xl font-medium glass hover:bg-white/60 transition border border-white/60"
                >
                  –í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Twitch
                </button>

                <label class="flex items-center gap-2 text-xs text-slate-700 select-none">
                  <input id="rememberNick" type="checkbox" class="h-4 w-4" checked />
                  –ó–∞–ø–æ–º–Ω–∏—Ç—å –≤—Ö–æ–¥ –Ω–∞ —ç—Ç–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ
                </label>

                <div id="tgInAppHint" class="hidden text-[11px] text-slate-600">
                  –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: Telegram –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –±—Ä–∞—É–∑–µ—Ä —á–∞—Å—Ç–æ –ª–æ–º–∞–µ—Ç OAuth. –ï—Å–ª–∏ –≤—Ö–æ–¥ –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç ‚Äî –æ—Ç–∫—Ä–æ–π —Å–∞–π—Ç –≤
                  Chrome/Safari.
                </div>
              </div>

              <div id="balanceAuthed" class="hidden space-y-3">
                <div class="glass rounded-2xl p-4 border border-white/60">
                  <div class="flex items-start justify-between gap-2">
                    <div class="min-w-0">
                      <div class="text-xs text-slate-600">–í–∞—à –Ω–∏–∫</div>
                      <div id="displayName" class="font-semibold truncate">‚Äî</div>
                      <div class="text-xs text-slate-600 mt-1">–í—ã –≤–æ—à–ª–∏ —á–µ—Ä–µ–∑ Twitch.</div>
                    </div>
                    <button
                      id="btnLogout"
                      type="button"
                      class="px-2 py-1 rounded-lg text-xs font-medium bg-white/70 hover:bg-white/90 transition border border-white/60"
                    >
                      –í—ã—Ö–æ–¥
                    </button>
                  </div>
                </div>

                <div class="glass rounded-2xl p-4 border border-white/60">
                  <div class="text-xs text-slate-600">–ë–∞–ª–ª—ã</div>
                  <div id="balanceValue" class="text-2xl font-extrabold tracking-tight">‚Äî</div>
                  <div id="balanceHint" class="mt-2 text-xs text-slate-600">–ù–∞–∂–º–∏ ¬´–û–±–Ω–æ–≤–∏—Ç—å¬ª, —á—Ç–æ–±—ã –ø–æ–¥—Ç—è–Ω—É—Ç—å –±–∞–ª–∞–Ω—Å –∏–∑ —Ç–∞–±–ª–∏—Ü—ã.</div>
                </div>

                <div class="flex flex-wrap gap-2">
                  <button
                    id="btnRefreshBalance"
                    type="button"
                    class="flex-1 px-4 py-2 rounded-xl bg-white/75 hover:bg-white transition border border-white/70 font-medium"
                  >
                    –û–±–Ω–æ–≤–∏—Ç—å
                  </button>

                  <button
                    id="btnCopyBalance"
                    type="button"
                    class="flex-1 px-4 py-2 rounded-xl glass hover:bg-white/60 transition border border-white/60 font-medium"
                  >
                    –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å !–ë–∞–ª–∞–Ω—Å
                  </button>
                </div>

                <div id="tgInAppHint2" class="hidden text-[11px] text-slate-600">
                  –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: Telegram –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –±—Ä–∞—É–∑–µ—Ä —á–∞—Å—Ç–æ –ª–æ–º–∞–µ—Ç OAuth. –ï—Å–ª–∏ –≤—Ö–æ–¥ –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç ‚Äî –æ—Ç–∫—Ä–æ–π —Å–∞–π—Ç –≤
                  Chrome/Safari.
                </div>
              </div>
            </aside>
          </div>
        </div>
      </section>

      <section id="products" class="mt-8 md:mt-10">
        <div class="glass glow rounded-3xl p-6 md:p-8 reveal">
          <div class="flex items-end justify-between gap-4 flex-wrap">
            <div>
              <h2 class="text-xl md:text-2xl font-bold">üõçÔ∏è –¢–æ–≤–∞—Ä—ã</h2>
              <p class="mt-2 text-slate-700 text-sm">–í—ã–±–∏—Ä–∞–π –Ω–∞–≥—Ä–∞–¥—É ‚Äî —Å–∞–π—Ç –ø—Ä–æ–∫—Ä—É—Ç–∏—Ç —Ç–µ–±—è –∫ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—é –∑–∞–∫–∞–∑–∞.</p>
            </div>
            <div class="text-sm text-slate-600">
              –í—ã–±—Ä–∞–Ω–Ω—ã–π —Ç–æ–≤–∞—Ä: <span id="selectedProductLabel" class="font-semibold text-slate-900">–Ω–µ –≤—ã–±—Ä–∞–Ω</span>
            </div>
          </div>

          <div id="productsGrid" class="mt-6 grid lg:grid-cols-2 gap-4"></div>
        </div>
      </section>

      <section id="howto" class="mt-8 md:mt-10 grid lg:grid-cols-2 gap-6 items-start">
        <div class="glass glow rounded-3xl p-6 md:p-8 reveal">
          <h2 class="text-xl md:text-2xl font-bold">–ö–∞–∫ –æ—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑?</h2>
          <p class="mt-3 text-slate-700 leading-relaxed">–ù–∞–ø–∏—à–∏—Ç–µ –º–Ω–µ –≤ –õ–° –≤ Telegram ‚Äî –æ–¥–Ω–∏–º –∫–ª–∏–∫–æ–º –∏–∑ —ç—Ç–æ–≥–æ —Å–∞–π—Ç–∞.</p>
          <ol class="mt-4 space-y-2 text-slate-800">
            <li>1) –í—ã–±–µ—Ä–∏ –Ω–∞–≥—Ä–∞–¥—É –≤ —Ä–∞–∑–¥–µ–ª–µ ¬´–¢–æ–≤–∞—Ä—ã¬ª.</li>
            <li>2) –î–æ–±–∞–≤—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ) –∏ –Ω–∞–∂–º–∏ ¬´–ó–∞–∫–∞–∑–∞—Ç—å¬ª.</li>
            <li>3) –Ø –ø–æ–ª—É—á—É –∑–∞–∫–∞–∑ –≤ Telegram –∏ –æ—Ç–≤–µ—á—É —Ç–µ–±–µ.</li>
          </ol>
        </div>

        <div id="order" class="glass glow rounded-3xl p-6 md:p-8 reveal">
          <div class="flex items-start justify-between gap-4">
            <div>
              <h3 class="text-xl font-bold">–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞</h3>
              <p class="mt-1 text-sm text-slate-700">–í—ã–±–µ—Ä–∏ —Ç–æ–≤–∞—Ä, –ø—Ä–æ–≤–µ—Ä—å –±–∞–ª–∞–Ω—Å –∏ –æ—Ç–ø—Ä–∞–≤—å –∑–∞–∫–∞–∑.</p>
            </div>
            <div class="text-right text-sm">
              <div class="text-slate-600">–°—Ç–æ–∏–º–æ—Å—Ç—å</div>
              <div id="orderCost" class="text-2xl font-extrabold">‚Äî</div>
            </div>
          </div>

          <div id="orderNeedAuth" class="mt-5">
            <div class="glass rounded-2xl p-4 border border-amber-200/70 bg-amber-50/60 text-sm text-amber-950">
              <div class="font-semibold">–ù—É–∂–Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è Twitch</div>
              <div class="mt-1 text-slate-700">
                –ß—Ç–æ–±—ã –æ—Ñ–æ—Ä–º–ª—è—Ç—å –∑–∞–∫–∞–∑ –∏ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –±–∞–ª–∞–Ω—Å, —Å–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏ —á–µ—Ä–µ–∑ Twitch (–±–ª–æ–∫ ¬´–ë–∞–ª–∞–Ω—Å¬ª).
              </div>
              <div class="mt-3">
                <button
                  id="btnLoginFromOrder"
                  type="button"
                  class="px-3 py-2 rounded-xl glass border border-white/60 hover:bg-white/60 transition text-xs font-semibold"
                >
                  –í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Twitch
                </button>
              </div>
            </div>
          </div>

          <div id="orderAuthed" class="hidden">
            <form id="orderForm" class="mt-5 space-y-3">
              <div class="glass rounded-2xl p-4 border border-white/60">
                <label class="text-xs text-slate-600">–¢–æ–≤–∞—Ä</label>
                <div id="orderProduct" class="font-semibold mt-1">–ù–µ –≤—ã–±—Ä–∞–Ω</div>
              </div>

              <div>
                <label for="comment" class="text-xs text-slate-600">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
                <textarea
                  id="comment"
                  rows="4"
                  class="mt-1 w-full rounded-2xl glass border border-white/60 p-4 outline-none focus:ring-2 focus:ring-white/60"
                  placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –∫–∞–∫–æ–π —Ñ–∏–ª—å–º / –∫–∞–∫–∞—è –∏–≥—Ä–∞ / –ª—é–±—ã–µ –ø–æ–∂–µ–ª–∞–Ω–∏—è"
                ></textarea>
              </div>

              <div id="inlineMsg" class="hidden glass rounded-2xl p-4 border border-white/60 text-sm"></div>

              <button
                id="btnOrder"
                type="submit"
                class="w-full px-5 py-3 rounded-2xl font-semibold bg-white/80 hover:bg-white transition border border-white/70"
              >
                –ó–∞–∫–∞–∑–∞—Ç—å
              </button>

              <button
                id="btnOrderAgain"
                type="button"
                class="hidden w-full px-5 py-3 rounded-2xl font-semibold glass hover:bg-white/60 transition border border-white/60"
              >
                –û—Ñ–æ—Ä–º–∏—Ç—å –µ—â—ë –æ–¥–∏–Ω –∑–∞–∫–∞–∑
              </button>
            </form>

            <div id="progressArea" class="hidden mt-5 glass rounded-2xl p-4 border border-white/60">
              <div class="flex items-center gap-3">
                <div
                  id="spinner"
                  class="h-5 w-5 rounded-full border-2 border-slate-900/25 border-t-slate-900 animate-spin"
                ></div>
                <div id="progressText" class="text-sm text-slate-800">–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∑–∞–∫–∞–∑...</div>
              </div>
              <div id="progressSub" class="mt-1 text-xs text-slate-600"></div>
            </div>
          </div>
        </div>
      </section>

      <footer class="mt-10">
        <div class="glass glow rounded-3xl p-6 md:p-8 text-sm text-slate-700 reveal">
          <div class="flex items-center justify-between gap-3 flex-wrap">
            <div>–°–¥–µ–ª–∞–Ω–æ –≤ —Å—Ç–∏–ª–µ: —Å—Ç–µ–∫–ª–æ, —Å–≤–µ—Ç –∏ –≥—Ä–∞–¥–∏–µ–Ω—Ç—ã. –¢–µ—Ö–Ω–∏–∫–∞ ‚Äî –∫–∞–∫ –≤ —Ä–∞–±–æ—á–µ–π –≤–µ—Ä—Å–∏–∏ —Å–∞–π—Ç–∞.</div>
            <a
              href="#top"
              class="px-4 py-2 rounded-xl glass hover:bg-white/60 transition border border-white/60 font-medium"
              >–ù–∞–≤–µ—Ä—Ö</a
            >
          </div>
        </div>
      </footer>
    </main>

    <div id="calcModal" class="hidden fixed inset-0 z-50">
      <div class="absolute inset-0 modal-backdrop"></div>
      <div class="relative mx-auto max-w-lg px-4 py-8">
        <div class="glass glow rounded-3xl p-6 md:p-7 border border-white/60">
          <div class="flex items-start justify-between gap-4">
            <div>
              <div class="text-lg font-bold">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –±–∞–ª–ª–æ–≤</div>
              <div class="text-sm text-slate-700 mt-1">–°—á–∏—Ç–∞–µ—Ç –ø–æ —Ñ–æ—Ä–º—É–ª–µ: S = 50√óN + 0.03√ó(50√óN)√ó(N-1)</div>
            </div>
            <button id="closeCalc" class="px-3 py-2 rounded-xl glass border border-white/60 hover:bg-white/60 transition">
              –ó–∞–∫—Ä—ã—Ç—å
            </button>
          </div>

          <div class="mt-5 grid grid-cols-[auto_1fr_auto] gap-2 items-center">
            <button id="clipsMinus" class="h-12 w-12 rounded-2xl glass border border-white/60 hover:bg-white/60 transition text-xl">
              ‚àí
            </button>

            <input
              id="clipsInput"
              inputmode="numeric"
              pattern="[0-9]*"
              class="h-12 w-full rounded-2xl glass border border-white/60 px-4 text-center text-lg font-semibold outline-none focus:ring-2 focus:ring-white/60"
              value="1"
            />

            <button id="clipsPlus" class="h-12 w-12 rounded-2xl glass border border-white/60 hover:bg-white/60 transition text-xl">
              +
            </button>
          </div>

          <div class="mt-4 glass rounded-2xl p-4 border border-white/60">
            <div class="text-xs text-slate-600">–†–µ–∑—É–ª—å—Ç–∞—Ç</div>
            <div class="mt-1 flex items-center justify-between gap-3">
              <div id="calcResult" class="text-3xl font-extrabold">50</div>
              <button id="copyCalc" class="px-4 py-2 rounded-xl bg-white/75 hover:bg-white transition border border-white/70 font-medium">
                –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
              </button>
            </div>
            <div class="mt-1 text-xs text-slate-600">–ó–∞–∫—Ä—ã—Ç–∏–µ: ESC</div>
          </div>
        </div>
      </div>
    </div>

    <div id="toastHost" class="fixed z-[60] bottom-4 left-0 right-0 px-4 flex flex-col items-center gap-2"></div>

    <!-- React entry (kept for build pipeline / Tailwind CSS) -->
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>

    <script>
      (() => {
        "use strict";

        // ===== In-app browsers fallback (from site #1) =====
        try{
          const ua = (navigator.userAgent || '').toLowerCase();
          const inApp = ua.includes('telegram') || ua.includes('instagram') || ua.includes('fbav') || ua.includes('fban');
          if(inApp) document.documentElement.classList.add('no-io');
          if(!('IntersectionObserver' in window)) document.documentElement.classList.add('no-io');
        }catch(e){
          document.documentElement.classList.add('no-io');
        }

        const $ = (sel, root=document) => root.querySelector(sel);
        const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));

        // ===== Config / endpoints (from site #1) =====
        const TELEGRAM_BOT_API_URL = 'https://script.google.com/macros/s/AKfycbzn3wvaFYwSWkopLZP1ueRb52pJnbWM7sB2Ay4DOx3FPPvBQITpaLF-cx2hflnZ10-_Xg/exec';
        const BALANCE_API_URL = 'https://script.google.com/macros/s/AKfycbxv93RskaQaMSQ4t41bpKLhUfx1RQHiwPl-tdYicJ12lvDJ7ZCZhSCAwR2PjSYqZDo/exec';

        const SPEND_ENABLED = true;
        const SPEND_TOKEN = 'yammy_spend_v1';

        const TWITCH_CLIENT_ID = '89zu7axvj9y80avfsn6a5l20mv5kjq';
        const TWITCH_REDIRECT_URI = 'https://yammyvt.github.io/YammyTanuki/';
        const TWITCH_SCOPES = [];

        const AUTH_STORAGE_KEY = 'yammy_twitch_auth_v2';

        // ===== Helpers =====
        const toastHost = $('#toastHost');
        function toast(msg, type='info', ttl=1900){
          const el = document.createElement('div');
          const base = 'glass border rounded-2xl px-4 py-3 shadow-[0_18px_55px_rgba(18,28,55,.14)] max-w-[92vw] text-sm';
          const colors = {
            info: 'bg-white/70 text-slate-900 border-white/60',
            ok: 'bg-emerald-50/70 text-emerald-900 border-emerald-200/70',
            warn: 'bg-amber-50/70 text-amber-950 border-amber-200/70',
            err: 'bg-rose-50/70 text-rose-900 border-rose-200/70',
          };
          el.className = base + ' ' + (colors[type] || colors.info);
          el.textContent = msg;
          toastHost?.appendChild(el);
          setTimeout(() => {
            el.style.opacity = '0';
            el.style.transform = 'translateY(10px)';
            el.style.transition = 'opacity .2s ease, transform .2s ease';
            setTimeout(() => el.remove(), 220);
          }, ttl);
        }

        async function copyText(text){
          try{
            await navigator.clipboard.writeText(text);
            return true;
          }catch(e){
            try{
              const ta = document.createElement('textarea');
              ta.value = text;
              ta.style.position = 'fixed';
              ta.style.left = '-9999px';
              document.body.appendChild(ta);
              ta.select();
              document.execCommand('copy');
              document.body.removeChild(ta);
              return true;
            }catch(err){
              return false;
            }
          }
        }

        function clampInt(n, min, max){
          n = Number.parseInt(n, 10);
          if(Number.isNaN(n)) n = min;
          return Math.max(min, Math.min(max, n));
        }

        function calcTotal(clips){
          clips = Math.max(0, Math.floor(Number(clips) || 0));
          const base = 50 * clips;
          const bonus = 0.03 * base * (clips - 1);
          return base + bonus;
        }

        function normNick(s){ return String(s ?? '').trim().toLowerCase(); }
        function parsePoints(v){
          if(v === null || v === undefined) return NaN;
          if(typeof v === 'number') return v;
          const s = String(v).trim().replace(',', '.');
          const n = Number(s);
          return Number.isFinite(n) ? n : NaN;
        }

        function isDesktop(){ return matchMedia('(min-width: 1024px)').matches; }
        function reduceMotion(){ return matchMedia('(prefers-reduced-motion: reduce)').matches; }

        function getIsAndroid(ua){ return /android/i.test(ua); }
        function getIsTelegramBrowser(ua){ return ua.includes('telegram') || ua.includes('tgwebview'); }
        function getInAppBrowser(ua){ return ua.includes('telegram') || ua.includes('instagram') || ua.includes('fbav') || ua.includes('fban'); }

        // ===== Reveal =====
        function initReveal(){
          try{
            const force = document.documentElement.classList.contains('no-io');
            const isSmallOrTablet = matchMedia('(max-width: 1024px)').matches;
            if(!force && !isSmallOrTablet && 'IntersectionObserver' in window){
              const io = new IntersectionObserver((entries)=>{
                for(const e of entries){
                  if(e.isIntersecting){ e.target.classList.add('is-in'); io.unobserve(e.target); }
                }
              }, { threshold: 0.12 });
              $$('.reveal').forEach(el => io.observe(el));
            }else{
              $$('.reveal').forEach(el => el.classList.add('is-in'));
            }
          }catch(e){
            $$('.reveal').forEach(el => el.classList.add('is-in'));
          }
        }

        // ===== Visual floaties =====
        function initFloaties(){
          if(!isDesktop() || reduceMotion()) return;
          const floaties = $$('.floaty');
          let t = 0;
          function loop(){
            t += 0.006;
            floaties.forEach((el, i) => {
              const amp = 10 + i * 4;
              const x = Math.sin(t + i) * amp;
              const y = Math.cos(t + i * 1.3) * amp;
              el.style.transform = `translate3d(${x}px, ${y}px, 0)`;
            });
            requestAnimationFrame(loop);
          }
          requestAnimationFrame(loop);
        }

        // ===== Petals =====
        function initPetals(){
          const host = $('#petals');
          if(!host) return;
          const force = document.documentElement.classList.contains('no-io');
          if(!isDesktop() || reduceMotion() || force) return;

          const rand = (min, max) => Math.random() * (max - min) + min;
          function createPetal(){
            const el = document.createElement('div');
            const size = rand(10, 18);
            const startX = rand(0, window.innerWidth);
            const drift = rand(-60, 60);
            const dur = rand(7, 12);
            const rot = rand(0, 360);
            const hue = rand(330, 360);
            const opacity = rand(0.25, 0.55);

            el.style.position = 'absolute';
            el.style.left = `${startX}px`;
            el.style.top = `-30px`;
            el.style.width = `${size}px`;
            el.style.height = `${size * 0.75}px`;
            el.style.borderRadius = '999px 999px 999px 0';
            el.style.transform = `rotate(${rot}deg)`;
            el.style.opacity = opacity.toFixed(2);
            el.style.background = `hsl(${hue} 85% 70% / .9)`;
            el.style.boxShadow = '0 10px 25px rgba(0,0,0,.08)';
            el.style.filter = 'blur(.2px)';
            el.style.pointerEvents = 'none';

            const keyframes = [
              { transform: `translate3d(0,0,0) rotate(${rot}deg)`, offset: 0 },
              { transform: `translate3d(${drift * 0.6}px, ${window.innerHeight * 0.45}px, 0) rotate(${rot + 160}deg)`, offset: 0.55 },
              { transform: `translate3d(${drift}px, ${window.innerHeight + 80}px, 0) rotate(${rot + 340}deg)`, offset: 1 },
            ];

            const anim = el.animate(keyframes, { duration: dur * 1000, easing: 'linear', iterations: 1 });
            anim.onfinish = () => el.remove();
            return el;
          }

          let running = true;
          const maxOnScreen = 18;
          const tick = () => {
            if(!running) return;
            const count = host.childElementCount;
            if(count < maxOnScreen){
              const add = Math.min(2, maxOnScreen - count);
              for(let i=0;i<add;i++) host.appendChild(createPetal());
            }
            setTimeout(tick, rand(450, 900));
          };

          tick();
          document.addEventListener('visibilitychange', () => { running = !document.hidden; if(running) tick(); });
        }

        // ===== Calculator =====
        const calcModal = $('#calcModal');
        const openCalc = $('#openCalc');
        const closeCalc = $('#closeCalc');
        const clipsMinus = $('#clipsMinus');
        const clipsPlus = $('#clipsPlus');
        const clipsInput = $('#clipsInput');
        const calcResult = $('#calcResult');
        const copyCalc = $('#copyCalc');

        function syncCalc(){
          const n = clampInt(clipsInput.value, 0, 9999);
          clipsInput.value = String(n);
          const s = calcTotal(n);
          calcResult.textContent = String(Math.round(s));
        }

        function openCalcModal(){
          calcModal.classList.remove('hidden');
          document.body.style.overflow = 'hidden';
          syncCalc();
          setTimeout(() => clipsInput.focus(), 50);
        }

        function closeCalcModal(){
          calcModal.classList.add('hidden');
          document.body.style.overflow = '';
        }

        // ===== Products =====
        const PRODUCTS = [
          {
            title: 'ü•® –ó–∞–∫—É—Å–∫–∏ (–ú–µ–º—ã)',
            badge: '—é–º–æ—Ä',
            note: '–õ—ë–≥–∫–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è ‚ú®',
            options: [
              { label: '20 –º–µ–º–æ–≤', price: 200 },
              { label: '45 –º–µ–º–æ–≤', price: 400 },
            ],
          },
          {
            title: 'üçø –û—Å–Ω–æ–≤–Ω–æ–µ –±–ª—é–¥–æ (–ö–∏–Ω–æ –∏ –ê–Ω–∏–º–µ)',
            badge: '–¥–æ 2 —á–∞—Å–æ–≤',
            note: '–ï—Å–ª–∏ –∑–∞–π–¥—ë—Ç ‚Äî —Å–º–æ—Ç—Ä–∏–º —Ñ—É–ª–ª.',
            options: [
              { label: '–§–∏–ª—å–º / –ú—É–ª—å—Ç—Ñ–∏–ª—å–º', price: 750 },
              { label: '–ê–Ω–∏–º–µ / –°–µ—Ä–∏–∞–ª / –¢–µ–ª–µ—à–æ—É', price: 750 },
            ],
          },
          {
            title: 'üå∂Ô∏è –ù–∞ –¥–µ—Å–µ—Ä—Ç (18+)',
            badge: '18+',
            note: '–ù–∞ —Ç–≤–æ–π/–º–æ–π –≤—ã–±–æ—Ä.',
            options: [
              { label: '–•–µ–Ω—Ç–∞–π –∞–Ω–∏–º–µ / –ü–æ—Ä–Ω–æ‚Äë–∏–≥—Ä—ã –Ω–∞ Boosty', price: 1000 },
            ],
          },
          {
            title: 'üéÆ –ì–µ–π–º–µ—Ä—Å–∫–∞—è –∑–æ–Ω–∞',
            badge: '2 —á–∞—Å–∞',
            note: '‚ùó –î–ª—è MMO ‚Äî —Ç–æ–ª—å–∫–æ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –∏–≥—Ä—ã. ‚ö†Ô∏è –ï—Å–ª–∏ –∏–≥—Ä–∞ –Ω–µ ¬´–∑–∞—à–ª–∞¬ª ‚Äî —Å—Ç–æ–ø —á–µ—Ä–µ–∑ 2 —á–∞—Å–∞.',
            options: [
              { label: '–ò–≥—Ä–∞—é –≤ –¢–í–û–Æ –∏–≥—Ä—É', price: 1500 },
            ],
          },
          {
            title: 'üëë –£–ª—å—Ç–∏–º–∞—Ç–∏–≤–Ω—ã–π –∑–∞–∫–∞–∑',
            badge: '–º–∞—Ä–∞—Ñ–æ–Ω',
            note: '–î–ª—è —Å–∞–º—ã—Ö –º–æ—â–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤ ‚ú®',
            options: [
              { label: '12 —á–∞—Å–æ–≤ —Å—Ç—Ä–∏–º–∞', price: 5000 },
            ],
          },
          {
            title: 'üñåÔ∏è –†–∏—Å—É–Ω–∫–∏',
            badge: '–∞—Ä—Ç',
            note: '–ù–µ–±–æ–ª—å—à–∏–µ —Ä–∏—Å—É–Ω–∫–∏ –ø–æ —Ç–≤–æ–µ–π –∏–¥–µ–µ ‚ú®',
            options: [
              { label: '–ó–∞–∫–∞–∑–∞—Ç—å –≤—Å—Ä–∞—Ç—ã—à–∞', price: 3000 },
            ],
          },
          {
            title: 'üéÅ –°–≤–æ–π –≤–∞—Ä–∏–∞–Ω—Ç',
            badge: '–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ',
            note: '–ì–ª–∞–≤–Ω–æ–µ ‚Äî —á—Ç–æ–±—ã –±—ã–ª–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ –∏ –ø–æ –ø—Ä–∞–≤–∏–ª–∞–º ‚ú®',
            options: [
              { label: '–•–æ—á—É –æ–±—Å—É–¥–∏—Ç—å –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π –∑–∞–∫–∞–∑', price: null },
            ],
          },
        ];

        function formatCoins(price){
          return (price === null || price === undefined) ? '‚Äî' : `${price} üôÇ`;
        }

        const productsGrid = $('#productsGrid');
        const selectedProductLabel = $('#selectedProductLabel');
        const orderProduct = $('#orderProduct');
        const orderCost = $('#orderCost');

        let picked = null; // { productTitle, optionLabel, price }

        function highlightSelection(){
          $$('#productsGrid [data-pick]').forEach(btn => {
            btn.style.outline = 'none';
            btn.style.boxShadow = '';
          });
          if(!picked) return;
          const activeBtn = $(`#productsGrid [data-pick="${encodeURIComponent(picked.productTitle + '|' + picked.optionLabel)}"]`);
          if(activeBtn){
            activeBtn.style.outline = '2px solid rgba(15,23,42,.25)';
            activeBtn.style.boxShadow = '0 0 0 6px rgba(255,255,255,.18)';
          }
        }

        function setSelectedProduct(p){
          if(!p){
            picked = null;
            if(selectedProductLabel) selectedProductLabel.textContent = '–Ω–µ –≤—ã–±—Ä–∞–Ω';
            if(orderProduct) orderProduct.textContent = '–ù–µ –≤—ã–±—Ä–∞–Ω';
            if(orderCost) orderCost.textContent = '‚Äî';
            highlightSelection();
            return;
          }

          picked = p;
          const costLabel = (p.price != null) ? `${p.price} üôÇ` : '‚Äî';
          if(selectedProductLabel) selectedProductLabel.textContent = `${p.optionLabel} ‚Ä¢ ${costLabel}`;
          if(orderProduct) orderProduct.textContent = p.optionLabel;
          if(orderCost) orderCost.textContent = costLabel;

          highlightSelection();
          toast(`–í—ã–±—Ä–∞–Ω–æ: ${p.optionLabel}`, 'ok', 1200);
          $('#order')?.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function renderProducts(){
          if(!productsGrid) return;
          productsGrid.innerHTML = '';

          for(const product of PRODUCTS){
            const card = document.createElement('div');
            card.className = 'glass rounded-3xl p-5 border border-white/60 hover:bg-white/60 transition reveal';

            const head = document.createElement('div');
            head.className = 'flex items-center justify-between gap-3';
            head.innerHTML = `
              <div>
                <div class="text-xs text-slate-600">${product.badge || ''}</div>
                <div class="text-lg font-bold">${product.title}</div>
              </div>
              <div class="text-xs text-slate-600">${product.note || ''}</div>
            `;

            const list = document.createElement('div');
            list.className = 'mt-4 grid gap-3 ' + (product.options.length > 1 ? 'sm:grid-cols-2' : '');

            for(const opt of product.options){
              const btn = document.createElement('button');
              btn.type = 'button';
              btn.className = 'text-left glass rounded-2xl p-4 border border-white/60 hover:bg-white/70 transition';
              btn.innerHTML = `
                <div class="text-sm text-slate-600">${formatCoins(opt.price)}</div>
                <div class="font-semibold">${opt.label}</div>
              `;
              const pickKey = encodeURIComponent(product.title + '|' + opt.label);
              btn.setAttribute('data-pick', pickKey);
              btn.addEventListener('click', () => setSelectedProduct({ productTitle: product.title, optionLabel: opt.label, price: opt.price }));
              list.appendChild(btn);
            }

            card.appendChild(head);
            card.appendChild(list);
            productsGrid.appendChild(card);
          }

          highlightSelection();
        }

        // ===== Auth storage =====
        function setAuth(obj){
          const rememberEl = $('#rememberNick');
          const remember = rememberEl ? rememberEl.checked !== false : true;
          const data = obj || {};
          try{
            if(remember === false){
              sessionStorage.setItem(AUTH_STORAGE_KEY, JSON.stringify(data));
              localStorage.removeItem(AUTH_STORAGE_KEY);
            }else{
              localStorage.setItem(AUTH_STORAGE_KEY, JSON.stringify(data));
              sessionStorage.removeItem(AUTH_STORAGE_KEY);
            }
          }catch(e){
            try{ localStorage.setItem(AUTH_STORAGE_KEY, JSON.stringify(data)); }catch(err){}
          }
        }

        function getAuth(){
          try{ const s = sessionStorage.getItem(AUTH_STORAGE_KEY); if(s) return JSON.parse(s); }catch(e){}
          try{ return JSON.parse(localStorage.getItem(AUTH_STORAGE_KEY) || '{}'); }catch(e){ return {}; }
        }

        function clearAuth(){
          try{ localStorage.removeItem(AUTH_STORAGE_KEY); }catch(e){}
          try{ sessionStorage.removeItem(AUTH_STORAGE_KEY); }catch(e){}
        }

        // ===== Twitch =====
        async function twitchGetUserHelix(accessToken){
          const res = await fetch('https://api.twitch.tv/helix/users', {
            headers: {
              'Authorization': `Bearer ${accessToken}`,
              'Client-ID': TWITCH_CLIENT_ID,
            }
          });
          const txt = await res.text();
          let json = null;
          try{ json = JSON.parse(txt); }catch(e){}
          if(!res.ok){
            const desc = json?.message || json?.error || txt.slice(0,200);
            throw new Error(`Failed to fetch user: ${desc}`);
          }
          const u = json?.data?.[0];
          const login = String(u?.login || '').trim();
          const display = String(u?.display_name || login).trim();
          return login ? { login, display_name: display, login_lower: login.toLowerCase() } : null;
        }

        function handleImplicitTokenFromHash(){
          const h = String(window.location.hash || '');
          if(!h || !h.includes('access_token=')) return null;
          const params = new URLSearchParams(h.replace(/^#/,''));
          const token = params.get('access_token');
          const state = params.get('state') || '';
          if(!token) return null;
          try{ history.replaceState({}, document.title, window.location.pathname + window.location.search); }catch(e){}
          return { access_token: token, state };
        }

        function getKnownNick(){ return String(getAuth()?.login || '').trim(); }
        function getKnownDisplayName(){
          const a = getAuth();
          return String(a?.display_name || a?.login || '').trim();
        }

        // ===== Balance (Google Sheets Apps Script) =====
        async function fetchBalances(){
          const res = await fetch(BALANCE_API_URL, { cache: 'no-store' });
          if(!res.ok) throw new Error('API request failed');
          const json = await res.json();
          if(!json || json.ok !== true || !Array.isArray(json.data)) throw new Error('Bad API payload');
          return json.data;
        }

        async function findBalanceByNick(nick){
          const needle = normNick(nick);
          if(!needle) return { found:false, reason:'empty' };
          const rows = await fetchBalances();
          const nickKeys = ['–ù–∏–∫–Ω–µ–π–º','–Ω–∏–∫–Ω–µ–π–º','Nick','nick','–ù–∏–∫','–Ω–∏–∫'];
          const pointsKeys = ['–ò—Ç–æ–≥–æ–≤—ã–µ –±–∞–ª–ª—ã','–∏—Ç–æ–≥–æ–≤—ã–µ –±–∞–ª–ª—ã','–ë–∞–ª–ª—ã','–±–∞–ª–ª—ã','Points','points'];
          for(const r of rows){
            const nickVal = nickKeys.map(k=>r[k]).find(v=>v!==undefined);
            const rowNick = normNick(nickVal);
            if(!rowNick) continue;
            if(rowNick === needle){
              const ptsVal = pointsKeys.map(k=>r[k]).find(v=>v!==undefined);
              const pts = parsePoints(ptsVal);
              return { found:true, nick: nickVal ?? nick, points: ptsVal, pointsNum: pts };
            }
          }
          return { found:false, reason:'notfound' };
        }

        async function spendPoints({nick, amount, item, comment}={}){
          const cleanNick = String(nick || '').trim();
          const a = Number(amount);
          if(!cleanNick) return { ok:false, reason:'nonick' };
          if(!Number.isFinite(a) || a <= 0) return { ok:false, reason:'badamount' };
          const payload = {
            action: 'spend',
            token: SPEND_TOKEN,
            nick: cleanNick,
            amount: a,
            item: String(item || '').slice(0, 200),
            comment: String(comment || '').slice(0, 500),
            at: Date.now(),
          };
          const res = await fetch(BALANCE_API_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'text/plain;charset=utf-8' },
            body: JSON.stringify(payload)
          });
          const txt = await res.text();
          try{ return JSON.parse(txt); }
          catch(e){ return { ok:false, reason:'badjson', raw: txt.slice(0,200) }; }
        }

        async function refreshBalance(){
          const out = $('#balanceValue');
          const hint = $('#balanceHint');
          const login = getKnownNick();
          const displayName = getKnownDisplayName();

          if(!login){
            if(out) out.textContent = '‚Äî';
            if(hint) hint.textContent = '–ù—É–∂–Ω–æ –≤–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Twitch, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –±–∞–ª–∞–Ω—Å.';
            return;
          }

          if(out) out.textContent = '–ó–∞–≥—Ä—É–∂–∞—é‚Ä¶';
          if(hint) hint.textContent = '–î–∞–Ω–Ω—ã–µ –ø–æ–¥—Ç—è–≥–∏–≤–∞—é—Ç—Å—è –∏–∑ Google –¢–∞–±–ª–∏—Ü—ã.';

          try{
            const res = await findBalanceByNick(login);
            if(res.found){
              const pts = Number.isFinite(res.pointsNum) ? Math.round(res.pointsNum) : res.points;
              if(out) out.textContent = `${displayName} ‚Äî ${pts} üôÇ`;
              if(hint) hint.textContent = '–ï—Å–ª–∏ –±–∞–ª–ª—ã –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç ‚Äî –ø—Ä–æ–≤–µ—Ä—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã.';
            }else{
              if(out) out.textContent = `${displayName} ‚Äî 0 üôÇ üò¢`;
              if(hint) hint.textContent = '–£ –≤–∞—Å 0 –±–∞–ª–ª–æ–≤ üò¢';
            }
          }catch(e){
            if(out) out.textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏.';
            if(hint) hint.textContent = '–ü—Ä–æ–≤–µ—Ä—å –¥–æ—Å—Ç—É–ø Apps Script (Deploy ‚Üí Web app ‚Üí –¥–æ—Å—Ç—É–ø: "–í—Å–µ").';
          }
        }

        function updateAuthUI(){
          const authed = !!getKnownNick();
          $('#balanceUnauthed')?.classList.toggle('hidden', authed);
          $('#balanceAuthed')?.classList.toggle('hidden', !authed);
          $('#orderNeedAuth')?.classList.toggle('hidden', authed);
          $('#orderAuthed')?.classList.toggle('hidden', !authed);
          if(authed){
            const dn = getKnownDisplayName();
            const el = $('#displayName');
            if(el) el.textContent = dn || '‚Äî';
          }
        }

        function showBalanceMsg(kind, title, text, actions=[]){
          const box = $('#balanceMsg');
          if(!box) return;
          const styles = {
            info: 'bg-white/70 border-white/60 text-slate-900',
            warn: 'bg-amber-50/70 border-amber-200/70 text-amber-950',
            err: 'bg-rose-50/70 border-rose-200/70 text-rose-900',
            ok: 'bg-emerald-50/70 border-emerald-200/70 text-emerald-900',
          };
          box.className = `glass rounded-2xl p-4 border text-sm ${styles[kind] || styles.info}`;
          box.innerHTML = '';
          const t = document.createElement('div');
          t.className = 'font-semibold';
          t.textContent = title;
          const p = document.createElement('div');
          p.className = 'mt-1 text-slate-700';
          p.textContent = text;
          box.appendChild(t);
          box.appendChild(p);
          if(actions && actions.length){
            const act = document.createElement('div');
            act.className = 'mt-3 flex flex-wrap gap-2';
            for(const a of actions){
              const b = document.createElement('button');
              b.type = 'button';
              b.className = 'px-3 py-2 rounded-xl glass border border-white/60 hover:bg-white/60 transition text-xs font-semibold';
              b.textContent = a.label;
              b.addEventListener('click', a.onClick);
              act.appendChild(b);
            }
            box.appendChild(act);
          }
          box.classList.remove('hidden');
        }

        function clearBalanceMsg(){
          const box = $('#balanceMsg');
          if(box){ box.classList.add('hidden'); box.innerHTML=''; }
        }

        function twitchLogin(){
          clearBalanceMsg();
          const ua = (navigator.userAgent || '').toLowerCase();
          const redirectUri = String(TWITCH_REDIRECT_URI || '').trim();

          if(getIsTelegramBrowser(ua)){
            showBalanceMsg('info', '–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≤ Telegram', 'Telegram –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –±—Ä–∞—É–∑–µ—Ä –∏–º–µ–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏. –°–∫–æ–ø–∏—Ä—É–π —Å—Å—ã–ª–∫—É –∏ –æ—Ç–∫—Ä–æ–π —Å–∞–π—Ç –≤ Chrome –∏–ª–∏ Safari –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.', [
              {
                label: '–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ —Å–∞–π—Ç',
                onClick: async () => {
                  const ok = await copyText(window.location.href);
                  toast(ok ? '–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞' : '–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å', ok ? 'ok' : 'err');
                }
              }
            ]);
            return;
          }

          const state = `implicit_${Math.random().toString(16).slice(2)}${Date.now()}`;
          const params = new URLSearchParams({
            client_id: TWITCH_CLIENT_ID,
            redirect_uri: redirectUri,
            response_type: 'token',
            scope: TWITCH_SCOPES.join(' '),
            state
          });

          const authUrl = `https://id.twitch.tv/oauth2/authorize?${params.toString()}`;

          if(getIsAndroid(ua)){
            const intentUrl = `intent://id.twitch.tv/oauth2/authorize?${params.toString()}#Intent;scheme=https;action=android.intent.action.VIEW;S.browser_fallback_url=${encodeURIComponent(authUrl)};end;;`;
            window.location.href = intentUrl;
            setTimeout(() => { window.location.href = authUrl; }, 500);
          }else{
            window.location.assign(authUrl);
          }
        }

        async function handleTwitchOAuthCallback(){
          const implicit = handleImplicitTokenFromHash();
          if(!implicit?.access_token) return;
          try{
            toast('–ü–æ–ª—É—á–∞–µ–º –ø—Ä–æ—Ñ–∏–ª—å Twitch‚Ä¶', 'info', 1400);
            const user = await twitchGetUserHelix(implicit.access_token);
            if(!user?.login) throw new Error('No login');
            setAuth({
              login: user.login,
              display_name: user.display_name,
              access_token: implicit.access_token,
              obtained_at: Date.now(),
              implicit: true
            });
            updateAuthUI();
            toast('–í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω', 'ok');
            await refreshBalance();
          }catch(e){
            clearAuth();
            updateAuthUI();
            toast('–ù–µ —É–¥–∞–ª–æ—Å—å –≤–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Twitch', 'err', 2400);
          }
        }

        function twitchLogout(){
          clearAuth();
          updateAuthUI();
          const out = $('#balanceValue');
          const hint = $('#balanceHint');
          if(out) out.textContent = '‚Äî';
          if(hint) hint.textContent = '–ù—É–∂–Ω–æ –≤–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Twitch, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –±–∞–ª–∞–Ω—Å.';
          toast('–í—ã –≤—ã—à–ª–∏', 'ok');
        }

        // ===== Telegram bot API (Apps Script) =====
        async function sendOrderToBot({nick, item, price, comment}){
          try{
            const res = await fetch(TELEGRAM_BOT_API_URL, {
              method: 'POST',
              headers: { 'Content-Type': 'text/plain' },
              body: JSON.stringify({
                nick: nick || '–ù–µ —É–∫–∞–∑–∞–Ω',
                item: item || '–ù–µ —É–∫–∞–∑–∞–Ω–æ',
                price: price || '‚Äî',
                comment: comment || '–ù–µ—Ç'
              })
            });
            const text = await res.text();
            try{ return JSON.parse(text); }
            catch(e){ return { ok:false, error:'–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ —Å–µ—Ä–≤–µ—Ä–∞', raw: text }; }
          }catch(e){
            return { ok:false, error: String(e?.message || e) };
          }
        }

        function pickedToItemText(p){
          if(!p) return '';
          const suffix = (p.price === null || p.price === undefined) ? '' : ` (${p.price} üôÇ)`;
          return `${p.productTitle} ‚Äî ${p.optionLabel}${suffix}`;
        }

        // ===== Order UI helpers =====
        const inlineMsg = $('#inlineMsg');
        const progressArea = $('#progressArea');
        const progressText = $('#progressText');
        const progressSub = $('#progressSub');
        const btnOrder = $('#btnOrder');
        const btnOrderAgain = $('#btnOrderAgain');
        const commentEl = $('#comment');

        let orderBusy = false;

        function showInline(type, text){
          if(!inlineMsg) return;
          inlineMsg.classList.remove('hidden');
          inlineMsg.classList.remove('bg-emerald-50/60','border-emerald-200/70','text-emerald-800');
          inlineMsg.classList.remove('bg-rose-50/60','border-rose-200/70','text-rose-700');
          inlineMsg.classList.remove('bg-amber-50/60','border-amber-200/70','text-amber-900');
          if(type === 'ok'){
            inlineMsg.classList.add('bg-emerald-50/60','border-emerald-200/70','text-emerald-800');
          }else if(type === 'err'){
            inlineMsg.classList.add('bg-rose-50/60','border-rose-200/70','text-rose-700');
          }else{
            inlineMsg.classList.add('bg-amber-50/60','border-amber-200/70','text-amber-900');
          }
          inlineMsg.textContent = text;
        }

        function hideInline(){
          if(!inlineMsg) return;
          inlineMsg.classList.add('hidden');
          inlineMsg.textContent = '';
        }

        function setProgress(on, text='', sub=''){
          if(!progressArea) return;
          progressArea.classList.toggle('hidden', !on);
          if(text) progressText.textContent = text;
          progressSub.textContent = sub || '';
        }

        function setOrderEnabled(enabled){
          if(btnOrder){
            btnOrder.disabled = !enabled;
            btnOrder.classList.toggle('opacity-60', !enabled);
            btnOrder.classList.toggle('cursor-not-allowed', !enabled);
          }
          if(commentEl) commentEl.disabled = !enabled;
        }

        function resetOrderUI(){
          hideInline();
          setProgress(false);
          btnOrderAgain?.classList.add('hidden');
          btnOrder?.classList.remove('hidden');
          setOrderEnabled(true);
          orderBusy = false;
        }

        btnOrderAgain?.addEventListener('click', () => {
          if(commentEl) commentEl.value = '';
          resetOrderUI();
          toast('–ú–æ–∂–Ω–æ –æ—Ñ–æ—Ä–º–∏—Ç—å –µ—â—ë –æ–¥–∏–Ω –∑–∞–∫–∞–∑', 'ok');
        });

        async function placeOrder(){
          hideInline();
          if(orderBusy) return;

          const nick = getKnownNick();
          const displayName = getKnownDisplayName();

          if(!nick){
            showInline('err', '–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏ —á–µ—Ä–µ–∑ Twitch, —á—Ç–æ–±—ã –æ—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑.');
            toast('–ù—É–∂–Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è Twitch', 'warn');
            return;
          }

          if(!picked){
            showInline('err', '–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏ —Ç–æ–≤–∞—Ä –≤ —Ä–∞–∑–¥–µ–ª–µ ¬´–¢–æ–≤–∞—Ä—ã¬ª.');
            toast('–í—ã–±–µ—Ä–∏ —Ç–æ–≤–∞—Ä', 'warn');
            return;
          }

          const spend = (picked.price === null || picked.price === undefined) ? NaN : Number(picked.price);
          const itemText = pickedToItemText(picked);
          const comment = (commentEl?.value || '').trim();

          orderBusy = true;
          setOrderEnabled(false);
          setProgress(true, '‚è≥ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∑–∞–∫–∞–∑‚Ä¶', '');

          try{
            // check balance
            if(SPEND_ENABLED && Number.isFinite(spend) && spend > 0){
              setProgress(true, 'üí∞ –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–∞–ª–∞–Ω—Å‚Ä¶', '–£–±–µ–∂–¥–∞–µ–º—Å—è —á—Ç–æ —Ö–≤–∞—Ç–∞–µ—Ç –±–∞–ª–ª–æ–≤');
              const res = await findBalanceByNick(nick);
              if(!res.found){
                setProgress(false);
                setOrderEnabled(true);
                orderBusy = false;
                showInline('err', '–£ –≤–∞—Å 0 –±–∞–ª–ª–æ–≤ üò¢ (–≤–∞—Å –Ω–µ—Ç –≤ —Ç–∞–±–ª–∏—Ü–µ).');
                return;
              }
              const currentBalance = Number.isFinite(res.pointsNum) ? Math.round(res.pointsNum) : 0;
              if(currentBalance < spend){
                setProgress(false);
                setOrderEnabled(true);
                orderBusy = false;
                showInline('err', `–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–∞–ª–ª–æ–≤ üò¢ –ù—É–∂–Ω–æ ${spend} üôÇ, –∞ —É —Ç–µ–±—è ${currentBalance} üôÇ.`);
                return;
              }
            }

            // send to telegram
            setProgress(true, 'üì® –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ Telegram‚Ä¶', '–í–∞—à –∑–∞–∫–∞–∑ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ø–º–∏');
            const priceText = Number.isFinite(spend) && spend > 0 ? `${spend} üôÇ` : '‚Äî';
            const result = await sendOrderToBot({
              nick: displayName || nick,
              item: itemText,
              price: priceText,
              comment: comment || '–ù–µ—Ç'
            });

            if(!result?.ok){
              setProgress(false);
              setOrderEnabled(true);
              orderBusy = false;
              showInline('err', '–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏. –ü–æ–ø—Ä–æ–±—É–π –µ—â—ë —Ä–∞–∑ –∏–ª–∏ –Ω–∞–ø–∏—à–∏ –Ø–º–∏ –≤ Telegram: @YammyTanuki');
              return;
            }

            // spend points
            if(SPEND_ENABLED && Number.isFinite(spend) && spend > 0){
              setProgress(true, 'üí∞ –°–ø–∏—Å—ã–≤–∞–µ–º –±–∞–ª–ª—ã‚Ä¶', '–û–±–Ω–æ–≤–ª—è–µ–º –≤–∞—à –±–∞–ª–∞–Ω—Å');
              const spendRes = await spendPoints({ nick, amount: spend, item: itemText, comment });
              if(spendRes?.ok){
                await refreshBalance();
              }
            }

            setProgress(false);
            showInline('ok', '–ó–∞–∫–∞–∑ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω! –ü–æ–ª—É—á–∏–ª —Ç–≤–æ–π –∑–∞–∫–∞–∑ üòä');

            // clear form / selection
            if(commentEl) commentEl.value = '';
            setSelectedProduct(null);

            btnOrder?.classList.add('hidden');
            btnOrderAgain?.classList.remove('hidden');
            toast('–ó–∞–∫–∞–∑ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω', 'ok');

            // allow next order after pressing "order again"
            orderBusy = false;
          }catch(e){
            setProgress(false);
            setOrderEnabled(true);
            orderBusy = false;
            showInline('err', '–û—à–∏–±–∫–∞ —Å–≤—è–∑–∏. –ù–µ —É–¥–∞–ª–æ—Å—å —Å–≤—è–∑–∞—Ç—å—Å—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º. –ü–æ–ø—Ä–æ–±—É–π –µ—â—ë —Ä–∞–∑.');
          }
        }

        // ===== Wiring =====
        function initCalculator(){
          openCalc?.addEventListener('click', openCalcModal);
          closeCalc?.addEventListener('click', closeCalcModal);
          calcModal?.addEventListener('click', (e) => { if(e.target === calcModal) closeCalcModal(); });
          window.addEventListener('keydown', (e) => { if(e.key === 'Escape' && !calcModal.classList.contains('hidden')) closeCalcModal(); });

          clipsMinus?.addEventListener('click', () => { clipsInput.value = String(clampInt(clipsInput.value, 0, 9999) - 1); syncCalc(); });
          clipsPlus?.addEventListener('click', () => { clipsInput.value = String(clampInt(clipsInput.value, 0, 9999) + 1); syncCalc(); });
          clipsInput?.addEventListener('input', syncCalc);
          copyCalc?.addEventListener('click', async () => {
            const ok = await copyText(`–ö–ª–∏–ø–æ–≤: ${clipsInput.value}. –ò—Ç–æ–≥–æ –±–∞–ª–ª–æ–≤: ${calcResult.textContent} üôÇ`);
            toast(ok ? '–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ' : '–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å', ok ? 'ok' : 'err');
          });
          syncCalc();
        }

        function initCopyButtons(){
          $('#copyBalanceCmd')?.addEventListener('click', async () => {
            const ok = await copyText('!–ë–∞–ª–∞–Ω—Å');
            toast(ok ? '–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ: !–ë–∞–ª–∞–Ω—Å' : '–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å', ok ? 'ok' : 'err');
          });
          $('#btnCopyBalance')?.addEventListener('click', async () => {
            const ok = await copyText('!–ë–∞–ª–∞–Ω—Å');
            toast(ok ? '–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ: !–ë–∞–ª–∞–Ω—Å' : '–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å', ok ? 'ok' : 'err');
          });
        }

        function initAuth(){
          const ua = (navigator.userAgent || '').toLowerCase();
          const inApp = getInAppBrowser(ua);
          const tg = getIsTelegramBrowser(ua);

          if(inApp){
            $('#inAppWarning')?.classList.remove('hidden');
          }
          if(tg){
            $('#tgInAppHint')?.classList.remove('hidden');
            $('#tgInAppHint2')?.classList.remove('hidden');
          }

          $('#btnLogin')?.addEventListener('click', twitchLogin);
          $('#btnLoginFromOrder')?.addEventListener('click', twitchLogin);
          $('#btnLogout')?.addEventListener('click', twitchLogout);
          $('#btnRefreshBalance')?.addEventListener('click', () => refreshBalance());

          // remember toggle: move auth between storages
          $('#rememberNick')?.addEventListener('change', () => {
            const auth = getAuth();
            if(!auth?.login) return;
            setAuth(auth);
          });

          // restore auth + remember checkbox
          const rememberEl = $('#rememberNick');
          if(rememberEl){
            rememberEl.checked = !!localStorage.getItem(AUTH_STORAGE_KEY);
          }

          updateAuthUI();

          const auth = getAuth();
          if(auth?.login){
            setTimeout(() => refreshBalance(), 250);
          }
        }

        function initOrder(){
          $('#orderForm')?.addEventListener('submit', (e) => {
            e.preventDefault();
            placeOrder();
          });
        }

        // ===== Boot =====
        function boot(){
          initFloaties();
          initPetals();

          renderProducts();

          // IMPORTANT: after products render (they have .reveal)
          initReveal();

          initCalculator();
          initCopyButtons();
          initAuth();
          initOrder();
          handleTwitchOAuthCallback();
        }

        if(document.readyState === 'loading'){
          document.addEventListener('DOMContentLoaded', boot, { once: true });
        }else{
          boot();
        }
      })();
    </script>
  </body>
</html>
